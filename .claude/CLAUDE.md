# Tolmach

CLI-утилита для транскрибации видео и генерации отчётов.

## Стек
- TypeScript, Node.js 20+, pnpm
- Строгая типизация (strict: true, noUncheckedIndexedAccess, exactOptionalPropertyTypes)

## Архитектура
- Слоистая: CLI → Domain → Infrastructure
- VideoProvider Registry — паттерн Strategy для провайдеров видео
- LLM Router — паттерн Strategy для LLM-провайдеров
- Pipeline Orchestrator — последовательное выполнение этапов
- Result<T, E> вместо try/catch
- Максимально твёрдый ООП: абстрактные классы, интерфейсы, инкапсуляция

## Соглашения
- **Никаких комментариев в коде** — код должен быть самодокументирующимся через говорящие имена. Исключения: eslint-disable директивы
- SOLID, DRY, без глубокой вложенности
- Value Objects для данных (immutable, валидация в конструкторе)
- DI через конструктор
- Модификаторы: private/readonly по умолчанию
- Никаких `any` — строго типизировано

## Тестирование — ОБЯЗАТЕЛЬНО
- Каждый класс домена ОБЯЗАН иметь unit-тесты
- Тесты пишутся ПАРАЛЛЕЛЬНО с кодом, не после
- Перед переходом к следующему этапу — ВСЕ тесты должны проходить
- Запуск: `pnpm test`
- Моки для внешних зависимостей (yt-dlp, whisper, Claude SDK)
- НЕ ПЕРЕХОДИТЬ к следующему этапу, пока тесты текущего не зелёные

## Прогресс
- Обновлять `docs/progress.md` после каждого выполненного пункта
- Отмечать галочками выполненные задачи
- Заполнять лог изменений с датой и статусом тестов

## README
- После любых изменений в функциональности — проверить, требуется ли обновление `README.md`
- Перед обновлением README — получить подтверждение пользователя

## Команды
- `pnpm dev` — запуск в dev-режиме
- `pnpm build` — сборка
- `pnpm test` — тесты (ЗАПУСКАТЬ ПЕРЕД КАЖДЫМ ЭТАПОМ)
- `pnpm lint` — линтинг

## Ключевые файлы
- `src/cli/index.ts` — точка входа
- `src/domain/pipeline/pipeline.orchestrator.ts` — ядро
- `src/domain/llm/llm-router.ts` — роутер LLM
- `src/domain/video/video-provider.registry.ts` — реестр провайдеров
